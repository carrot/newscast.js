/*! newscast.js - v0.1.1 - 2015-02-12 */
!function(a){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a():window.Newscast=a.call(this)}(function(){var a="NEWSCAST",b=new RegExp("(\\S+)"+a+"(.+)$"),c=function(c){var d=c,e=null,f={},g=function(a,b){c.debug&&(b||(a="Newscast.Receiver: "+a),console.log(a))},h=function(){},i=function(){c.onReceiverAddSender&&c.onReceiverAddSender()},j=function(){c.onReceiverLostSender&&c.onReceiverLostSender()},k=function(a){g("Received message: "+a.data);var c=a.data.match(b),d=c[1],e=c[2];l(d,e)},l=function(a,b){if(a in f)for(var c=0;c<f[a].length;c++)f[a][c](b)},m=function(a,b){a in f||(f[a]=[]),f[a].push(b)},n=function(b,c){c=b+a+c,g("Sending message: "+c),e.broadcast(c)};g("Initializing receiver");var o=cast.receiver.CastReceiverManager.getInstance();return e=o.getCastMessageBus(d.namespace),e.onMessage=k,o.onReady=h,o.onSenderConnected=i,o.onSenderDisconnected=j,o.start(),{onMessage:m,sendMessage:n}},d=function(c){var d=c,e=null,f={},g=function(a,b){c.debug&&(b||(a="Newscast.Sender: "+a),console.log(a))},h=function(a){g("Session reconnected"),e=a,e.addUpdateListener(i),e.addMessageListener(d.namespace,s),c.onSenderStarted&&c.onSenderStarted()},i=function(a){a||(g("Session no longer alive"),c.onSenderStopped&&c.onSenderStopped())},j=function(a){a===chrome.cast.ReceiverAvailability.AVAILABLE?(g("Receiver is available"),c.onSenderReady&&c.onSenderReady()):a===chrome.cast.ReceiverAvailability.UNAVAILABLE&&(g("Receiver not available"),g(a,!0))},k=function(){g("Chromecast initialized")},l=function(a){g("Chromecast initialization failed, error:"),g(a,!0)},m=function(){g("Starting cast"),chrome.cast.requestSession(n,o)},n=function(a){g("Session created"),e=a,e.addUpdateListener(i),e.addMessageListener(d.namespace,s),d.onSenderStarted&&d.onSenderStarted()},o=function(a){g("Failed to create session, error:"),g(a,!0)},p=function(){g("Stopping cast"),e.stop(q,r)},q=function(){g("Cast stopped"),c.onSenderStopped&&c.onSenderStopped()},r=function(a){g("Failed to stop cast, error:"),g(a,!0)},s=function(a,c){g("Received message: "+c);var d=c.match(b),e=d[1],f=d[2];t(e,f)},t=function(a,b){if(a in f)for(var c=0;c<f[a].length;c++)f[a][c](b)},u=function(a,b){a in f||(f[a]=[]),f[a].push(b)},v=function(b,d){d=b+a+d,g("Sending message: "+d),e.sendMessage(c.namespace,d,w,x)},w=function(){g("Message sent")},x=function(a){g("Failed to send message, error:"),g(a,!0)};g("Initializing sender");var y=new chrome.cast.SessionRequest(c.appId),z=new chrome.cast.ApiConfig(y,h,j,chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED);return chrome.cast.initialize(z,k,l),{startCasting:m,stopCasting:p,sendMessage:v,onMessage:u}},e=function(a){var b=a;a.hasOwnProperty("isReceiver")||(a.isReceiver=window.location.search.indexOf("newscast-receiver=true")>=0);var e=function(b,c){a.debug&&(c||(b="Newscast.Newcast: "+b),console.log(b))},f=document.createElement("script");f.async=!1,f.type="text/javascript",a.isReceiver?(f.src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js",f.onload=function(){var d=new c(b);a.onReceiverCreated(d)},document.body.appendChild(f)):(window.__onGCastApiAvailable=function(c,f){if(c){var g=new d(b);a.onSenderCreated(g)}else e("Failed to load Chromecast library, error:"),e(f,!0)},f.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js",document.body.appendChild(f))};return{Receiver:c,Sender:d,Newscast:e}});